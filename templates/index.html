{% extends 'base.html' %}
{% block title %}Model Generator{% endblock %}
{% block content %}
<div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold mb-6 text-center">Model Generator</h1>

    <!-- Upload Form -->
    <div class="bg-white p-6 rounded-lg shadow-md mb-8">
        <h2 class="text-xl font-semibold mb-4">Upload CSV to Generate Model</h2>
        <form id="uploadForm" method="POST" action="{{ url_for('upload') }}" enctype="multipart/form-data" onsubmit="return validateForm()">
            <div class="mb-4">
                <label for="model_name" class="block text-sm font-medium text-gray-700">Model Name</label>
                <input type="text" id="model_name" name="model_name" class="mt-1 p-2 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200" required>
            </div>
            <div class="mb-4">
                <label for="description" class="block text-sm font-medium text-gray-700">Description</label>
                <textarea id="description" name="description" class="mt-1 p-2 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200" rows="4" required></textarea>
            </div>
            
            <div class="mb-4">
                <label for="training_mode" class="block text-sm font-medium text-gray-700">Training Mode</label>
                <select id="training_mode" name="training_mode" class="mt-1 p-2 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200">
                    {% for mode, config in model_configs.items() %}
                    <option value="{{ mode }}">{{ mode|capitalize }} - {{ config.description }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="mb-4">
                <label for="preprocessing_mode" class="block text-sm font-medium text-gray-700">Preprocessing Mode</label>
                <select id="preprocessing_mode" name="preprocessing_mode" class="mt-1 p-2 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200">
                    {% for mode, config in preprocessing_configs.items() %}
                    <option value="{{ mode }}">{{ mode|capitalize }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="mb-4">
                <label for="test_size" class="block text-sm font-medium text-gray-700">Test Size (0.1 - 0.5)</label>
                <input type="number" id="test_size" name="test_size" min="0.1" max="0.5" step="0.05" value="0.2" class="mt-1 p-2 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200">
            </div>
            
            <div class="mb-4">
                <label for="file" class="block text-sm font-medium text-gray-700">CSV File</label>
                <input type="file" id="file" name="file" accept=".csv" class="mt-1 p-2 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200" required>
            </div>
            <button type="submit" class="w-full bg-indigo-600 text-white p-2 rounded-md hover:bg-indigo-700">Generate Model</button>
        </form>
    </div>

    <!-- Model List -->
    <h2 class="text-xl font-semibold mb-4">Generated Models</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        {% for model in models %}
        <div class="bg-white p-4 rounded-lg shadow-md">
            <h3 class="text-lg font-medium">{{ model.name }}</h3>
            <p class="text-gray-600 mb-2">{{ model.description }}</p>
            <p class="text-sm text-gray-500">
                Uploaded: {{ model.upload_date.strftime('%Y-%m-%d %H:%M:%S') if model.upload_date else 'Unknown' }}
            </p>
            <p class="text-sm text-gray-500">Likes: {{ model.like_count if model.like_count is not none else 0 }}</p>
            <div class="mt-4 flex space-x-2">
                {% if model.model_file_path %}
                <a href="{{ url_for('download_best_model', model_id=model.model_id) }}" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Download Model</a>
                {% endif %}
                {% if model.document_file_path %}
                <a href="{{ url_for('download_doc', model_id=model.model_id) }}" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Download Doc</a>
                {% endif %}
                <form action="{{ url_for('like_model', model_id=model.model_id) }}" method="POST">
                    <button type="submit" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">Like</button>
                </form>
            </div>
        </div>
        {% else %}
        <p class="text-gray-500">No models available.</p>
        {% endfor %}
    </div>
</div>

<script>
function validateForm() {
    const fileInput = document.getElementById('file');
    const file = fileInput.files[0];
    
    if (!file) {
        alert('Please select a CSV file');
        return false;
    }
    
    if (!file.name.toLowerCase().endsWith('.csv')) {
        alert('Only CSV files are allowed');
        return false;
    }
    
    // Show loading message or spinner
    document.getElementById('uploadForm').insertAdjacentHTML('afterend', 
        '<div class="mt-4 p-2 bg-blue-100 text-blue-700 rounded">Uploading and processing your file. Please wait...</div>');
    
    return true;
}
</script>
{% endblock %}